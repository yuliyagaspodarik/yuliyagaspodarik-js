<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tennis Dom</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="wrapper">
    <div id="score"><span id="left-score">0</span>:<span id="right-score">0</span></div>
    <input id="start" type="button" value="страт!">
    <div id="field">
      <div id="scroll-left"></div>
      <div id="scroll-right"></div>
      <div id="ball"></div>
    </div>
  </div>
  <script>
    'use strict';

    var requestAnimateFrame =
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.oRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      function (callback) {
        window.setTimeout(callback, 1000 / 60);
      };

    var game = {
      field: {
        width: 800,
        height: 400
      },
      scrollLeft: {
        width: 15,
        height: 150,
        posX: 0,
        posY: 0,
        SpeedY: 0,
        update: function () {
          document.getElementById('scroll-left').style.transform = 'translate(' + this.posX + 'px, ' + this.posY + 'px)';
        }
      },
      scrollRight: {
        width: 15,
        height: 150,
        posX: 785,
        posY: 0,
        SpeedY: 0,
        update: function () {
          document.getElementById('scroll-right').style.transform = 'translate(' + this.posX + 'px, ' + this.posY + 'px)';
        }
      },
      ball: {
        width: 50,
        height: 50,
        posX: 400,/*this.field.width / 2,*/
        posY: 200,/*this.field.height / 2,*/
        speedX: 1,
        speedY: 1,
        update: function () {
          document.getElementById('ball').style.transform = 'translate(' + this.posX + 'px, ' + this.posY + 'px)';
        }
      },
      counterLeft: 0,
      counterRight: 0,
      moveDown(obj) {
        game.setSpeed(obj);
        obj.posY += obj.SpeedY;
        if (obj.posY + obj.height >= game.field.height) {
          obj.posY = game.field.height - obj.height;
        }
      },
      moveUp(obj) {
        game.setSpeed(obj);
        obj.posY -= obj.SpeedY;
        if (obj.posY < 0) {
          obj.posY = 0;
        }
      },
      setSpeed(obj) {
        obj.SpeedY = 3;
      },
      scroll(event) {
        switch (event.code) {
          case 'ControlLeft':
            game.moveDown(game.scrollLeft);
            break;
          case 'ShiftLeft':
            game.moveUp(game.scrollLeft);
            break;
          case 'ArrowDown':
            game.moveDown(game.scrollRight);
            break;
          case 'ArrowUp':
            game.moveUp(game.scrollRight);
            break;
        }
        game.scrollRight.update();
        game.scrollLeft.update();
      },
      start() {
        window.requestAnimationFrame(game.play);
        //setInterval(game.play, 40);
      },
      play() {
        game.posXBall();
        game.posYBall();
        if (game.ball.posX + game.ball.width >= game.field.width) {
          game.goalRight();
        }
        if (game.ball.posX < 0) {
          game.goalLeft();
        }
        game.updateScore();
        game.ball.update();
        game.scrollLeft.update();
        game.scrollRight.update();
        window.requestAnimationFrame(game.play);
      },
      posXBall() {
        this.ball.posX += this.ball.speedX;
        if (this.ball.posX + this.ball.width >= this.scrollRight.posX && this.ball.posY >= this.scrollRight.posY && this.ball.posY <= this.scrollRight.posY + this.scrollRight.height) {
          this.ball.speedX = -this.ball.speedX;
          this.ball.posX = this.field.width - this.scrollRight.width - this.ball.width;
        }

        if (this.ball.posX <= this.scrollLeft.posX + this.scrollLeft.width && this.ball.posY >= this.scrollLeft.posY && this.ball.posY <= this.scrollLeft.posY + this.scrollLeft.height) {
          this.ball.speedX = -this.ball.speedX;
          this.ball.posX = this.scrollLeft.width;
        }
        return ball;
      },
      posYBall() {
        this.ball.posY += this.ball.speedY;
        if (this.ball.posY + this.ball.height > this.field.height) {
          this.ball.speedY = -this.ball.speedY;
          this.ball.posY = this.field.height - this.ball.height;
        }
        if (this.ball.posY < 0) {
          this.ball.speedY = -this.ball.speedY;
          this.ball.posY = 0;
        }
        return ball;
      },
      resetSpeed() {
        this.ball.speedX = 0;
        this.ball.speedY = 0;
      },
      goalRight() {
        this.ball.posX = this.field.width - this.ball.width;
        this.counterLeft++;
        this.resetSpeed();
        this.stop();
      },
      goalLeft() {
        this.ball.posX = 0;
        this.counterRight++;
        this.resetSpeed();
        this.stop();
        //this.updateScore();
      },
      stop() {
        cancelAnimationFrame(game.play);
        //window.location.reload();
      },
      updateScore() {
        document.getElementById('left-score').textContent = this.counterLeft;
        document.getElementById('right-score').textContent = this.counterRight;
      }
    };

    game.ball.update();
    game.scrollLeft.update();
    game.scrollRight.update();
    document.addEventListener('keydown', game.scroll);
    document.getElementById('start').addEventListener('click', game.start);
  </script>
</body>
</html>